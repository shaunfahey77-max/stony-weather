<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stony's Weather Station | Pro Build</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --green: #00f5b7;
            --text: #f2f2f2;
            --tile-bg: rgba(18, 22, 38, 0.78); 
            --body-bg: #050a1a;
            --border-color: rgba(255, 255, 255, 0.12);
            --accent-red: #ff4d4d;
            --glass: blur(40px) saturate(180%);
            --mac-shadow: 0 25px 50px rgba(0,0,0,0.6);
            --ease: cubic-bezier(0.23, 1, 0.32, 1);
        }

        body.light-mode {
            --tile-bg: rgba(240, 242, 245, 0.92);
            --text: #1a1a2e;
            --body-bg: #eef2f7;
            --border-color: rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        
        body {
            margin: 0; padding: 0;
            font-family: "Poppins", sans-serif;
            background: var(--body-bg) url('./background.png') no-repeat center center fixed;
            background-size: cover;
            color: var(--text);
            min-height: 100vh;
            transition: background 0.8s var(--ease);
        }

        /* --- NAVIGATION --- */
        .mac-menu-bar {
            height: 32px; background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(20px);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 22px; font-size: 0.82rem; position: sticky; top: 0; z-index: 10002;
            border-bottom: 1px solid rgba(255,255,255,0.1); color: #fff;
        }

        /* --- RESPONSIVE GRID ENGINE --- */
        .app-shell {
            max-width: 1700px; margin: 0 auto; padding: 20px 40px 100px;
            display: grid; grid-template-columns: 1.15fr 0.85fr; gap: 30px;
        }

        @media (max-width: 1024px) {
            .app-shell { grid-template-columns: 1fr; padding: 15px; }
            .primary-temp { font-size: 6rem !important; }
            .current-header-grid { grid-template-columns: 1fr !important; text-align: center; }
            .sensor-matrix { grid-template-columns: repeat(2, 1fr) !important; }
            .radar-panel { height: 450px !important; }
        }

        /* --- RADAR FIX (Controls Visible) --- */
        .radar-panel { 
            grid-column: 1 / -1; height: 600px; padding: 0; 
            overflow: hidden; background: #000; border-radius: 45px;
            box-shadow: var(--mac-shadow); border: 1px solid var(--border-color);
        }

        #radarFrame { 
            width: 100%; height: 112%; 
            border: none; margin-top: -28px; /* Specifically hides search, keeps controls */
        }

        /* --- UI COMPONENTS --- */
        .glass-tile {
            background: var(--tile-bg); border-radius: 45px; padding: 40px;
            border: 1px solid var(--border-color); backdrop-filter: var(--glass);
            box-shadow: var(--mac-shadow);
        }

        header { padding: 40px 20px; text-align: center; }
        .title-main { font-size: clamp(3rem, 8vw, 5.5rem); font-weight: 900; line-height: 0.8; }
        .title-sub { font-size: 1.2rem; letter-spacing: 8px; color: var(--green); text-transform: uppercase; }

        .current-header-grid { display: grid; grid-template-columns: 100px 1fr 250px; gap: 25px; align-items: center; }
        .primary-temp { font-size: 9rem; font-weight: 900; color: var(--green); letter-spacing: -5px; }
        
        .sensor-matrix { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 30px; }
        .data-point { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 20px; text-align: center; border: 1px solid var(--border-color); }

        .forecast-grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .day-card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; }

        .mac-btn {
            width: 100%; padding: 12px; border-radius: 15px; border: 2px solid var(--green);
            background: transparent; color: var(--green); font-weight: bold; cursor: pointer; margin-bottom: 10px;
        }

        .system-dock { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 20px; display: flex; gap: 20px; backdrop-filter: blur(10px); }
        .zip-input { background: rgba(255,255,255,0.1); border: none; color: #fff; width: 60px; text-align: center; border-radius: 5px; }

        /* Modals */
        .mac-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 20000; padding: 20px; }
        .modal-body { background: var(--tile-bg); max-width: 800px; margin: 50px auto; padding: 40px; border-radius: 30px; color: #fff; max-height: 80vh; overflow-y: auto; }
    </style>
</head>
<body class="dark-mode">

    <div class="mac-menu-bar">
        <div><i class="fa-brands fa-apple"></i> <strong>StonyWeather</strong> <input type="text" id="zipInput" class="zip-input" maxlength="5"></div>
        <div id="systemClock">12:00 PM</div>
    </div>

    <header>
        <div class="title-main">Stony's</div>
        <div class="title-sub">Weather Station</div>
    </header>

    <main class="app-shell">
        <div class="glass-tile">
            <div class="current-header-grid">
                <img src="mascot.png" width="100" style="border-radius:20px" alt="Mascot">
                <div>
                    <div class="primary-temp" id="dispTemp">--°</div>
                    <div style="color:var(--green); font-weight:bold; text-transform:uppercase" id="dispSummary">Loading...</div>
                </div>
                <div>
                    <button class="mac-btn" onclick="openModal('modalAFD')">Forecaster Discussion</button>
                    <button class="mac-btn" id="hazardBtn" onclick="openModal('modalAlerts')">No Hazards</button>
                </div>
            </div>
            <p id="dispDetail" style="opacity:0.8; margin: 20px 0;"></p>
            <div class="sensor-matrix">
                <div class="data-point"><span>Feels Like</span><br><strong id="valFeels">--</strong></div>
                <div class="data-point"><span>Wind</span><br><strong id="valWind">--</strong></div>
                <div class="data-point"><span>Humidity</span><br><strong id="valHum">--</strong></div>
                <div class="data-point"><span>Visibility</span><br><strong id="valVis">--</strong></div>
                <div class="data-point"><span>UV Index</span><br><strong id="valUV">--</strong></div>
                <div class="data-point"><span>Dew Point</span><br><strong id="valDew">--</strong></div>
            </div>
        </div>

        <div class="glass-tile">
            <h3 style="margin-top:0"><i class="fa-solid fa-calendar"></i> 14-Day Forecast</h3>
            <div id="gridForecast" class="forecast-grid-container"></div>
        </div>

        <div class="glass-tile radar-panel">
            <iframe id="radarFrame" src=""></iframe>
        </div>
    </main>

    <div class="system-dock">
        <div onclick="toggleTheme()"><i class="fa-solid fa-circle-half-stroke"></i></div>
        <div onclick="refreshStation()"><i class="fa-solid fa-sync"></i></div>
    </div>

    <div id="modalAFD" class="mac-modal" onclick="closeModal('modalAFD')"><div class="modal-body"><h2>Discussion</h2><pre id="bodyAFD" style="white-space:pre-wrap"></pre></div></div>
    <div id="modalAlerts" class="mac-modal" onclick="closeModal('modalAlerts')"><div class="modal-body"><h2>Alerts</h2><div id="bodyAlerts"></div></div></div>

    <script>
        async function refreshStation() {
            const zip = document.getElementById('zipInput').value || "03101";
            try {
                const geo = await fetch(`https://api.zippopotam.us/us/${zip}`).then(r => r.json());
                const { latitude: lat, longitude: lon } = geo.places[0];

                // Update Radar with Controls enabled
                document.getElementById('radarFrame').src = `https://www.rainviewer.com/map.html?loc=${lat},${lon},10&control=1&map=1&type=1`;

                const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,wind_speed_10m,uv_index,visibility,dew_point_2m&daily=weather_code,temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=auto`).then(r => r.json());
                
                document.getElementById('dispTemp').innerText = Math.round(w.current.temperature_2m) + "°";
                document.getElementById('valFeels').innerText = Math.round(w.current.apparent_temperature) + "°";
                document.getElementById('valWind').innerText = w.current.wind_speed_10m + " mph";
                document.getElementById('valHum').innerText = w.current.relative_humidity_2m + "%";
                document.getElementById('valVis').innerText = (w.current.visibility / 1609).toFixed(1) + " mi";
                document.getElementById('valUV').innerText = w.current.uv_index;
                document.getElementById('valDew').innerText = Math.round(w.current.dew_point_2m) + "°";

                const grid = document.getElementById('gridForecast');
                grid.innerHTML = "";
                w.daily.time.forEach((t, i) => {
                    grid.innerHTML += `<div class="day-card"><span>${t.split('-').slice(1).join('/')}</span><strong>${Math.round(w.daily.temperature_2m_max[i])}°</strong></div>`;
                });

                // NWS Data
                const p = await fetch(`https://api.weather.gov/points/${lat},${lon}`).then(r => r.json());
                const f = await fetch(p.properties.forecast).then(r => r.json());
                document.getElementById('dispDetail').innerText = f.properties.periods[0].detailedForecast;
                document.getElementById('dispSummary').innerText = f.properties.periods[0].shortForecast;
            } catch(e) { console.log(e); }
        }

        function toggleTheme() { document.body.classList.toggle('light-mode'); }
        function openModal(id) { document.getElementById(id).style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        setInterval(() => { document.getElementById('systemClock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); }, 1000);
        document.getElementById('zipInput').addEventListener('change', refreshStation);
        
        refreshStation();
    </script>
</body>
</html>
