<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stony's Weather Station | Master Build</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --green: #00f5b7;
            --text: #f2f2f2;
            --tile-bg: rgba(18, 22, 38, 0.85); 
            --body-bg: #050a1a;
            --border-color: rgba(255, 255, 255, 0.12);
            --accent-red: #ff4d4d;
            --glass: blur(40px) saturate(180%);
            --mac-shadow: 0 25px 50px rgba(0,0,0,0.6);
        }

        body.light-mode {
            --tile-bg: rgba(240, 242, 245, 0.95);
            --text: #1a1a2e;
            --body-bg: #eef2f7;
            --border-color: rgba(0, 0, 0, 0.1);
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        
        body {
            margin: 0; padding: 0;
            font-family: "Poppins", sans-serif;
            background: var(--body-bg) url('./background.png') no-repeat center center fixed;
            background-size: cover;
            color: var(--text);
            min-height: 100vh;
            transition: background 0.5s ease;
        }

        /* --- MAC MENU BAR --- */
        .mac-menu-bar {
            height: 32px; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(20px);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 22px; font-size: 0.82rem; position: sticky; top: 0; z-index: 10002;
            border-bottom: 1px solid rgba(255,255,255,0.1); color: #fff;
        }

        /* --- THE RESPONSIVE ENGINE --- */
        .app-shell {
            max-width: 1700px;
            margin: 0 auto;
            padding: 20px 40px 100px;
            display: grid;
            /* This section is what makes it work like the original */
            grid-template-columns: 1.1fr 0.9fr;
            grid-template-areas: 
                "main-tile side-tile"
                "radar-tile radar-tile";
            gap: 30px;
        }

        @media (max-width: 1150px) {
            .app-shell {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "main-tile"
                    "side-tile"
                    "radar-tile";
                padding: 15px;
            }
            .primary-temp { font-size: 6.5rem !important; }
            .sensor-matrix { grid-template-columns: repeat(2, 1fr) !important; }
            .current-header-grid { grid-template-columns: 100px 1fr !important; }
            .btn-stack { grid-column: span 2; flex-direction: row !important; margin-top: 15px; }
        }

        .area-main { grid-area: main-tile; }
        .area-side { grid-area: side-tile; }
        .area-radar { grid-area: radar-tile; }

        /* --- TILES --- */
        .glass-tile {
            background: var(--tile-bg);
            border-radius: 40px;
            padding: 40px;
            border: 1px solid var(--border-color);
            backdrop-filter: var(--glass);
            box-shadow: var(--mac-shadow);
            display: flex;
            flex-direction: column;
        }

        header { padding: 40px 20px 10px; text-align: center; }
        .title-main { font-size: clamp(3rem, 7vw, 5.5rem); font-weight: 900; line-height: 0.8; margin: 0; }
        .title-sub { font-size: 1.5rem; letter-spacing: 10px; color: var(--green); text-transform: uppercase; margin-top: 10px; }

        /* --- CURRENT WEATHER CONTENT --- */
        .current-header-grid { 
            display: grid; 
            grid-template-columns: 120px 1fr 240px; 
            gap: 25px; 
            align-items: center; 
        }

        .primary-temp { font-size: 9.5rem; font-weight: 900; color: var(--green); line-height: 0.8; letter-spacing: -5px; }
        .condition-label { font-weight: 900; color: var(--green); letter-spacing: 3px; text-transform: uppercase; font-size: 1.2rem; }

        .sensor-matrix { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 20px; 
            margin-top: 30px; 
        }

        .data-point { 
            background: rgba(255,255,255,0.05); padding: 25px 15px; 
            border-radius: 25px; border: 1px solid var(--border-color); text-align: center; 
        }
        
        .d-label { display: block; font-size: 0.75rem; text-transform: uppercase; opacity: 0.5; margin-bottom: 8px; letter-spacing: 1px; }
        .d-value { font-weight: 600; font-size: 1.6rem; color: #fff; }

        /* --- 14 DAY OUTLOOK --- */
        .forecast-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .day-card { 
            background: rgba(255,255,255,0.04); padding: 18px; border-radius: 22px; 
            display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color);
        }

        /* --- RADAR PANEL --- */
        .radar-container { 
            height: 650px; padding: 0; overflow: hidden; 
            background: #000; border-radius: 40px; position: relative;
        }
        #radarFrame { width: 100%; height: 110%; border: none; margin-top: -32px; }

        /* --- BUTTONS & MODALS --- */
        .btn-stack { display: flex; flex-direction: column; gap: 12px; }
        .mac-btn {
            padding: 14px; border-radius: 15px; border: 2px solid var(--green);
            background: transparent; color: var(--green); font-weight: 900; cursor: pointer;
            text-transform: uppercase; font-size: 0.8rem; transition: 0.2s ease-in-out;
        }
        .mac-btn:hover { background: var(--green); color: #000; transform: translateY(-2px); }

        .mac-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 20000; backdrop-filter: blur(15px); padding: 20px; }
        .modal-content { background: var(--tile-bg); max-width: 900px; margin: 50px auto; padding: 50px; border-radius: 35px; border: 1px solid var(--green); position: relative; max-height: 80vh; overflow-y: auto; }
        .close-btn { position: absolute; top: 25px; right: 35px; font-size: 2.5rem; color: var(--green); cursor: pointer; }

        .zip-input { background: rgba(255,255,255,0.2); border: none; color: #fff; width: 80px; text-align: center; border-radius: 8px; padding: 5px; font-weight: bold; outline: none; }
    </style>
</head>
<body class="dark-mode">

    <div class="mac-menu-bar">
        <div><i class="fa-brands fa-apple"></i> <strong>StonyWeather</strong> &nbsp; <input type="text" id="zipInput" class="zip-input" maxlength="5" placeholder="ZIP"></div>
        <div id="systemClock">--:-- --</div>
    </div>

    <header>
        <h1 class="title-main">Stony's</h1>
        <div class="title-sub">Weather Station</div>
    </header>

    <main class="app-shell">
        <div class="area-main">
            <div class="glass-tile" style="height: 100%;">
                <div class="current-header-grid">
                    <img src="mascot.png" width="120" style="border-radius:25px" alt="Mascot">
                    <div>
                        <div class="primary-temp" id="dispTemp">--¬∞</div>
                        <div class="condition-label" id="dispSummary">Initializing...</div>
                    </div>
                    <div class="btn-stack">
                        <button class="mac-btn" onclick="openModal('modalAFD')">Discussion</button>
                        <button class="mac-btn" id="hazardBtn" onclick="openModal('modalAlerts')">No Hazards</button>
                    </div>
                </div>
                
                <p id="dispDetail" style="opacity:0.8; margin: 30px 0; line-height: 1.7; font-size: 1.05rem;"></p>
                
                <div class="sensor-matrix">
                    <div class="data-point"><span class="d-label">Feels Like</span><span class="d-value" id="valFeels">--</span></div>
                    <div class="data-point"><span class="d-label">Wind Speed</span><span class="d-value" id="valWind">--</span></div>
                    <div class="data-point"><span class="d-label">Humidity</span><span class="d-value" id="valHum">--</span></div>
                    <div class="data-point"><span class="d-label">Visibility</span><span class="d-value" id="valVis">--</span></div>
                    <div class="data-point"><span class="d-label">UV Index</span><span class="d-value" id="valUV">--</span></div>
                    <div class="data-point"><span class="d-label">Dew Point</span><span class="d-value" id="valDew">--</span></div>
                </div>
            </div>
        </div>

        <div class="area-side">
            <div class="glass-tile">
                <h3 style="margin:0 0 25px 0; letter-spacing: 4px; font-size: 1rem; opacity: 0.6; text-transform: uppercase;"><i class="fa-solid fa-calendar-days" style="color:var(--green)"></i> 14-Day Outlook</h3>
                <div id="gridForecast" class="forecast-grid"></div>
            </div>
        </div>

        <div class="area-radar">
            <div class="glass-tile radar-container">
                <iframe id="radarFrame" src=""></iframe>
            </div>
        </div>
    </main>

    <div id="modalAFD" class="mac-modal"><div class="modal-content"><span class="close-btn" onclick="closeModal('modalAFD')">&times;</span><h2 style="color:var(--green)">Forecaster Discussion</h2><pre id="bodyAFD" style="white-space:pre-wrap; font-family:monospace; line-height:1.5;"></pre></div></div>
    <div id="modalAlerts" class="mac-modal"><div class="modal-content"><span class="close-btn" onclick="closeModal('modalAlerts')">&times;</span><h2 style="color:var(--accent-red)">Active Hazards</h2><div id="bodyAlerts"></div></div></div>

    <script>
        function getIcon(code) {
            if(code === 0) return "‚òÄÔ∏è";
            if(code < 4) return "‚õÖ";
            if(code < 51) return "üå´Ô∏è";
            if(code < 61) return "üåßÔ∏è";
            if(code < 80) return "‚ùÑÔ∏è";
            return "‚õàÔ∏è";
        }

        async function refreshStation() {
            const zip = document.getElementById('zipInput').value || "03101";
            try {
                const geo = await fetch(`https://api.zippopotam.us/us/${zip}`).then(r => r.json());
                const { latitude: lat, longitude: lon } = geo.places[0];

                // Update Radar
                document.getElementById('radarFrame').src = `https://www.rainviewer.com/map.html?loc=${lat},${lon},10&control=1&map=1&type=1&color=1`;

                // Fetch Data
                const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,wind_speed_10m,uv_index,visibility,dew_point_2m&daily=weather_code,temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=auto&forecast_days=14`).then(r => r.json());
                
                document.getElementById('dispTemp').innerText = Math.round(w.current.temperature_2m) + "¬∞";
                document.getElementById('valFeels').innerText = Math.round(w.current.apparent_temperature) + "¬∞";
                document.getElementById('valWind').innerText = Math.round(w.current.wind_speed_10m) + " mph";
                document.getElementById('valHum').innerText = w.current.relative_humidity_2m + "%";
                document.getElementById('valVis').innerText = (w.current.visibility / 1609).toFixed(1) + " mi";
                document.getElementById('valUV').innerText = w.current.uv_index;
                document.getElementById('valDew').innerText = Math.round(w.current.dew_point_2m) + "¬∞";

                const grid = document.getElementById('gridForecast');
                grid.innerHTML = "";
                w.daily.time.forEach((t, i) => {
                    const date = new Date(t + 'T00:00').toLocaleDateString('en-US', {weekday:'short', month:'numeric', day:'numeric'});
                    grid.innerHTML += `
                        <div class="day-card">
                            <span style="font-weight:bold; font-size:0.85rem;">${date}</span>
                            <span>${getIcon(w.daily.weather_code[i])}</span>
                            <span style="font-weight:900; color:var(--green);">${Math.round(w.daily.temperature_2m_max[i])}¬∞</span>
                        </div>`;
                });

                // NWS APIs
                const p = await fetch(`https://api.weather.gov/points/${lat},${lon}`).then(r => r.json());
                const f = await fetch(p.properties.forecast).then(r => r.json());
                document.getElementById('dispDetail').innerText = f.properties.periods[0].detailedForecast;
                document.getElementById('dispSummary').innerText = f.properties.periods[0].shortForecast;

                // Alerts
                const alerts = await fetch(`https://api.weather.gov/alerts/active?point=${lat},${lon}`).then(r => r.json());
                const hBtn = document.getElementById('hazardBtn');
                if(alerts.features.length > 0) {
                    hBtn.innerText = "Hazards Active";
                    hBtn.style.borderColor = "var(--accent-red)";
                    hBtn.style.color = "var(--accent-red)";
                    document.getElementById('bodyAlerts').innerHTML = alerts.features.map(a => `<h3>${a.properties.event}</h3><p>${a.properties.headline}</p>`).join('<hr>');
                }

                // Discussion
                const afdList = await fetch(`https://api.weather.gov/products/types/AFD/locations/${p.properties.gridId}`).then(r => r.json());
                if(afdList['@graph'] && afdList['@graph'][0]) {
                    const afd = await fetch(afdList['@graph'][0]['@id']).then(r => r.json());
                    document.getElementById('bodyAFD').innerText = afd.productText;
                }

            } catch(e) { console.error(e); }
        }

        function openModal(id) { document.getElementById(id).style.display = 'block'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        
        setInterval(() => { 
            document.getElementById('systemClock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}); 
        }, 1000);

        document.getElementById('zipInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') refreshStation(); });
        refreshStation();
    </script>
</body>
</html>
